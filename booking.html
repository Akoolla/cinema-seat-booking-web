<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Axbridge Roxy - Bookings</title>
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Expires" CONTENT="-1">
<link href="css/bootstrap.min.css" rel="stylesheet" />

<script src="js/jquery/jquery-1.11.2.min.js"></script>
<script src="js/jquery/jquery.form.min.js" charset="utf-8"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/validation.js"></script>
<script src="js/bookings.js"></script>

<script>
	var restService = "http://localhost:8080/";
	var wheelChairPrice = 1;
	var standardPrice;
	var concessionCost;

	$(function() {
		$("#nav").load("nav.html");
	});

	$(document).ready(
			function() {
				$("#nav").load("nav.html");

				//Set-up add person form
				var options = {
					url : '/booking/make/',
					dataType : 'jsonp',
					jsonp : 'json.wrf',
					type : 'post',
					clearForm : true,
					timeout : 3000
				};

				$('#makeBooking').ajaxForm(options);

				$("#email").on(
						"change",
						function() {
							$("#emailIcon").removeClass("hidden").removeClass(
									"glyphicon-ok").removeClass(
									"glyphicon-remove");
							if (validateEmail($(this).val())) {
								$("#emailGrp").removeClass("has-error")
										.addClass("has-success");
								$("#emailIcon").addClass("glyphicon-ok");
							} else {
								$("#emailGrp").removeClass("has-success")
										.addClass("has-error");
								$("#emailIcon").addClass("glyphicon-remove");
							}
						});
				
				$("#standard").on("change", function(){ updateTotalCost(); });
				$("#wheelchairs").on("change", function(){ updateTotalCost(); });
				$("#concessions").on("change", function(){ updateTotalCost(); });
				
				loadScreening();
				});
	
	function loadScreening(){
		$.ajax({
			'url' : restService + 'screening/2131',
			'success' : function(data) {
				populateScreeningData(data);
			},
			'dataType' : 'jsonp',
			'jsonp' : 'json.wrf'
		});
	}
	
	function updateTotalCost(){
		var totalCost = 0;
		totalCost = totalCost + $("#standard").val() * standardPrice;
		totalCost = totalCost + $("#wheelchairs").val() * wheelChairPrice;
		totalCost = totalCost + $("#concessions").val() * concessionCost;

		pence = totalCost % 100;
		pounds = (totalCost / 100) - (pence/100);
		
		$("#costPounds").val(pounds);
		$("#costPence").empty();
		$("#costPence").append("." + pence);
	}
	
	function populateScreeningData(data){
		wheelChairPrice = data.screening.wheelChairPrice;
		standardPrice = data.screening.standardPrice;
		concessionCost = data.screening.concessionCost;
	}
</script>
</head>
<body>
	<div id="nav"></div>
	<div class="container">
		<div class="col-md-4">
			<form class="form-horizontal" id="makeBooking" method="post">
				<div class="form-group">
					<label>Booking for:</label>
					<p class="form-control-static">What We Do In The Shadows (15) -
						Friday, Apr 1st 8:30pm</p>
				</div>

				<div class="form-group">
					<label for="name" class="control-label">Name</label> <input
						class="form-control" type="text" placeholder="Please enter name"
						id="name" name="name">

				</div>
				<div class="form-group has-feedback" id="emailGrp">
					<label for="email" class="control-label">Email</label> <input
						class="form-control" type="text"
						placeholder="Please enter email address" id="email" name="email"
						aria-describedby="emailSuccessStatus"> <span
						class="glyphicon glyphicon-ok form-control-feedback hidden"
						aria-hidden="true" id="emailIcon"></span> <span
						id="emailSuccessStatus" class="sr-only">(success)</span>
				</div>

				<div class="form-group">
					<div class="checkbox">
						<label> <input type="checkbox" value=""> Tick if a
							member
						</label>
					</div>
				</div>


				<div class="form-group">
					<label for="standard">Number of Standard Seats</label> <input
						class="form-control" type="text" placeholder="No. Standard Seats"
						id="standard" name="standard">
				</div>

				<div class="form-group">
					<label for="concessions">Number of Concession Seats</label> <input
						class="form-control" type="text" placeholder="No. Concessions"
						id="concessions" name="concessions">
				</div>

				<div class="form-group">
					<label for="wheelchairs">Number of Wheelchairs</label> <input
						class="form-control" type="text" placeholder="No. Wheelchairs"
						id="wheelchairs" name="wheelchairs">
				</div>


				<div class="row">
					<div class="col-xs-6">
						<div class="form-group">
							<label class="sr-only" for="exampleInputAmount">0
								(in pounds)</label>
							<div class="input-group">
								<div class="input-group-addon">Â£</div>
								<input type="text" class="form-control" id="costPounds"
									placeholder="0" readonly>
								<div class="input-group-addon" id="costPence">.00</div>
							</div>
						</div>
					</div>
					<div class="col-xs-6">
						<button type="submit" class="btn btn-primary">Book Seats</button>
					</div>
				</div>
			</form>
		</div>
	</div>

	<script>
		$('email').on('change', function() {
			alert(this.value);
		});
	</script>
</body>
</html>
